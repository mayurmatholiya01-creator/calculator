<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>TilesPro Calculator</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  
  <!-- Tailwind Configuration -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          },
          colors: {
            primary: '#6366f1', // Indigo 500
            'primary-dark': '#4f46e5', // Indigo 600
            secondary: '#a855f7', // Purple 500
            surface: '#18181b', // Zinc 900
            'surface-glass': 'rgba(24, 24, 27, 0.7)',
          },
          animation: {
            'fade-in': 'fadeIn 0.4s ease-out',
            'slide-up': 'slideUp 0.3s ease-out',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0', transform: 'translateY(10px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            },
            slideUp: {
              '0%': { transform: 'translateY(20px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' },
            }
          }
        }
      }
    }
  </script>

  <!-- Global Styles -->
  <style>
    body {
      background-color: #09090b;
      background-image: radial-gradient(at 50% 0%, rgba(99, 102, 241, 0.15) 0, transparent 50%), radial-gradient(at 100% 100%, rgba(168, 85, 247, 0.1) 0, transparent 50%);
      background-attachment: fixed;
      color: #f4f4f5;
      -webkit-tap-highlight-color: transparent;
      min-height: 100vh;
    }
    
    /* Smooth Scrolling */
    html {
      scroll-behavior: smooth;
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #52525b; }
    
    /* Glassmorphism Classes */
    .glass {
      background: rgba(24, 24, 27, 0.6);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    
    .glass-card {
      background: rgba(30, 30, 35, 0.65);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }

    /* Hide number input spinners */
    input[type=number]::-webkit-inner-spin-button, 
    input[type=number]::-webkit-outer-spin-button { 
      -webkit-appearance: none; 
      margin: 0; 
    }
    input[type=number] {
      -moz-appearance: textfield;
    }

    /* Text Shadow */
    .text-shadow-sm {
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
  </style>

  <!-- Import Map for React & Libraries -->
  <script type="importmap">
  {
    "imports": {
      "react": "https://esm.sh/react@18.2.0",
      "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
      "lucide-react": "https://esm.sh/lucide-react@0.263.1",
      "uuid": "https://esm.sh/uuid@9.0.0"
    }
  }
  </script>
  
  <!-- Babel Standalone for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>

  <!-- Main Application Script -->
  <script type="text/babel" data-type="module">
    import React, { useState, useEffect, useRef, useCallback, useMemo } from 'react';
    import { createRoot } from 'react-dom/client';
    import { Trash2, Search, X, RefreshCcw, Share2, Copy, Plus, Mail, MessageSquare } from 'lucide-react';
    import { v4 as uuidv4 } from 'uuid';

    // --- CONSTANTS ---
    const SKU_MASTER = [
      // Wall Tiles
      { name: "300x600 mm (12x24) Wall", l: 300, w: 600, mm: "8.5", pcs: 5, kg: 13.5 },
      { name: "300x450 mm (12x18) Wall", l: 300, w: 450, mm: "7.5", pcs: 6, kg: 10.5 },
      { name: "250x375 mm (10x15) Wall", l: 250, w: 375, mm: "7", pcs: 8, kg: 10 },
      
      // GVT / PGVT
      { name: "600x600 mm (2x2) GVT", l: 600, w: 600, mm: "8.5", pcs: 4, kg: 27 },
      { name: "600x1200 mm (2x4) GVT", l: 600, w: 1200, mm: "9", pcs: 2, kg: 28 },
      { name: "800x800 mm (32x32) GVT", l: 800, w: 800, mm: "9", pcs: 3, kg: 38 },
      { name: "800x1600 mm (32x64) GVT", l: 800, w: 1600, mm: "9", pcs: 2, kg: 50 },
      { name: "1000x1000 mm GVT", l: 1000, w: 1000, mm: "9", pcs: 2, kg: 40 },
      
      // Slabs
      { name: "1200x1200 mm (4x4)", l: 1200, w: 1200, mm: "9", pcs: 2, kg: 58 },
      { name: "1200x1800 mm (4x6)", l: 1200, w: 1800, mm: "9", pcs: 2, kg: 88 },
      { name: "1200x2400 mm (4x8) 9mm", l: 1200, w: 2400, mm: "9", pcs: 1, kg: 60 },
      { name: "1200x2400 mm (4x8) 15mm", l: 1200, w: 2400, mm: "15", pcs: 1, kg: 92 },
      
      // Heavy/Parking
      { name: "300x300 mm (12x12) Heavy", l: 300, w: 300, mm: "8", pcs: 10, kg: 16 },
      { name: "400x400 mm (16x16) Parking", l: 400, w: 400, mm: "9", pcs: 5, kg: 15 },
      { name: "600x600 mm Full Body (16mm)", l: 600, w: 600, mm: "16", pcs: 2, kg: 25 },

      // Planks
      { name: "200x1000 mm Wood Plank", l: 200, w: 1000, mm: "9", pcs: 5, kg: 20 },
      { name: "200x1200 mm Wood Plank", l: 200, w: 1200, mm: "9", pcs: 5, kg: 23 }
    ];

    const INITIAL_CARD = {
      id: 'init',
      skuName: '',
      length: 0,
      width: 0,
      thickness: '',
      piecesPerBox: 0,
      weightPerBox: 0,
      mode: 'area',
      quantity: 0,
      price: 0,
      gst: 18
    };

    // --- COMPONENTS ---

    // 1. Calculator Card Component
    const CalculatorCard = React.memo(({ 
      data, 
      isAdvanced, 
      isSingle, 
      onUpdate, 
      onDelete,
      onResultChange 
    }) => {
      const [showSuggestions, setShowSuggestions] = useState(false);
      const [filteredSku, setFilteredSku] = useState([]);
      const suggestionsRef = useRef(null);

      // Constants for formatting
      const fmt = new Intl.NumberFormat('en-IN', { maximumFractionDigits: 0 });
      const fmt2 = new Intl.NumberFormat('en-IN', { maximumFractionDigits: 2 });
      const fmt3 = new Intl.NumberFormat('en-IN', { maximumFractionDigits: 3 });
      const fmtCurr = new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 });

      // Calculation Logic
      useEffect(() => {
        let m2PerBox = 0;
        let ft2PerBox = 0;
        
        if (data.length > 0 && data.width > 0 && data.piecesPerBox > 0) {
          m2PerBox = (data.length * data.width * data.piecesPerBox) / 1000000;
          ft2PerBox = m2PerBox * 10.7639;
        }

        let numBoxes = 0;
        let totalPieces = 0;
        let totalAreaFt2 = 0;
        let totalWeightTons = 0;
        let totalPrice = 0;

        if (data.quantity > 0 && ft2PerBox > 0) {
          if (data.mode === 'area') {
            numBoxes = Math.ceil(data.quantity / ft2PerBox);
          } else {
            numBoxes = Math.ceil(data.quantity);
          }

          totalPieces = numBoxes * data.piecesPerBox;
          totalAreaFt2 = numBoxes * ft2PerBox;
          totalWeightTons = (numBoxes * data.weightPerBox) / 1000;

          if (data.price > 0) {
            const basePrice = totalAreaFt2 * data.price;
            const gstAmount = basePrice * (data.gst / 100);
            totalPrice = basePrice + gstAmount;
          }
        }

        onResultChange(data.id, {
          numBoxes,
          totalPieces,
          totalAreaFt2,
          totalWeightTons,
          totalPrice,
          coveragePerBoxFt2: ft2PerBox,
          coveragePerBoxM2: m2PerBox
        });
      }, [data, onResultChange]);

      // Handle SKU Search
      const handleSearchChange = (e) => {
        const val = e.target.value;
        onUpdate(data.id, { skuName: val });
        
        if (val.length > 0) {
          const matches = SKU_MASTER.filter(s => s.name.toLowerCase().includes(val.toLowerCase()));
          setFilteredSku(matches);
          setShowSuggestions(true);
        } else {
          setShowSuggestions(false);
        }
      };

      const selectSku = (sku) => {
        onUpdate(data.id, {
          skuName: sku.name,
          length: sku.l,
          width: sku.w,
          thickness: sku.mm,
          piecesPerBox: sku.pcs,
          weightPerBox: sku.kg
        });
        setShowSuggestions(false);
      };

      // Close suggestions on click outside
      useEffect(() => {
        const handleClickOutside = (event) => {
          if (suggestionsRef.current && !suggestionsRef.current.contains(event.target)) {
            setShowSuggestions(false);
          }
        };
        document.addEventListener("mousedown", handleClickOutside);
        return () => document.removeEventListener("mousedown", handleClickOutside);
      }, []);

      // Compute local display values for the render
      const m2PerBox = (data.length * data.width * data.piecesPerBox) / 1000000;
      const ft2PerBox = m2PerBox * 10.7639;
      let numBoxes = 0, totalAreaFt2 = 0, totalWeight = 0, totalPrice = 0;
      
      if (data.quantity > 0 && ft2PerBox > 0) {
        if (data.mode === 'area') numBoxes = Math.ceil(data.quantity / ft2PerBox);
        else numBoxes = Math.ceil(data.quantity);
        
        totalAreaFt2 = numBoxes * ft2PerBox;
        totalWeight = (numBoxes * data.weightPerBox) / 1000;
        
        if (data.price > 0) {
          const base = totalAreaFt2 * data.price;
          totalPrice = base + (base * (data.gst/100));
        }
      }

      return (
        <div className="glass-card rounded-2xl p-4 md:p-5 relative transition-all duration-300 mb-4 animate-fade-in hover:border-primary/30">
          {/* Delete Button (Only in advanced mode) */}
          {isAdvanced && !isSingle && (
            <button 
              onClick={() => onDelete(data.id)}
              className="absolute -top-2 -right-2 bg-red-500 hover:bg-red-600 text-white p-1.5 rounded-full shadow-lg transition-transform hover:scale-110 z-10 border-2 border-surface"
            >
              <Trash2 size={16} />
            </button>
          )}

          {/* Row 1: Search */}
          <div className="mb-4 relative" ref={suggestionsRef}>
            <label className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1 block">Tile Size & Thickness</label>
            <div className="relative group">
              <input
                type="text"
                className="w-full bg-zinc-900/40 border border-zinc-700/60 rounded-lg py-3 pl-3 pr-10 text-sm font-medium text-white focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all shadow-inner"
                placeholder="Search size (e.g. 600x1200)"
                value={data.skuName}
                onChange={handleSearchChange}
              />
              {data.skuName ? (
                <button 
                  onClick={() => onUpdate(data.id, { skuName: '' })}
                  className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white transition-colors"
                >
                  <X size={16} />
                </button>
              ) : (
                <Search size={16} className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none group-focus-within:text-primary transition-colors" />
              )}
            </div>
            
            {/* Autocomplete Dropdown */}
            {showSuggestions && filteredSku.length > 0 && (
              <div className="absolute z-50 top-full left-0 right-0 mt-1 bg-[#1a1a1e] border border-zinc-700 rounded-lg shadow-2xl max-h-56 overflow-y-auto animate-slide-up">
                {filteredSku.map((item, idx) => (
                  <div 
                    key={idx} 
                    onClick={() => selectSku(item)}
                    className="px-4 py-3 text-sm text-gray-200 hover:bg-primary/20 hover:text-white cursor-pointer border-b border-zinc-800 last:border-none transition-colors"
                  >
                    <span className="font-semibold">{item.name}</span>
                    <div className="text-xs text-gray-500 mt-0.5">{item.l}x{item.w} • {item.pcs} pcs • {item.kg}kg</div>
                  </div>
                ))}
              </div>
            )}
          </div>

          {/* Row 2: 5-Box Grid specs */}
          <div className="mb-4 bg-zinc-900/30 rounded-lg p-3 border border-white/5">
            <div className="grid grid-cols-5 gap-2">
              {[
                { label: 'Length', val: data.length || '', key: 'length', ph: '0' },
                { label: 'Width', val: data.width || '', key: 'width', ph: '0' },
                { label: 'Thick', val: data.thickness, key: 'thickness', ph: 'mm' },
                { label: 'Pcs/Box', val: data.piecesPerBox || '', key: 'piecesPerBox', ph: '0' },
                { label: 'Kg/Box', val: data.weightPerBox || '', key: 'weightPerBox', ph: '0' },
              ].map((field, idx) => (
                <div key={idx} className="flex flex-col items-center">
                  <label className="text-[9px] md:text-[10px] text-gray-500 uppercase font-bold mb-1.5 whitespace-nowrap">{field.label}</label>
                  <input
                    type={field.key === 'thickness' ? 'text' : 'number'}
                    className="w-full bg-black/20 border border-zinc-700/60 rounded text-center py-2 text-sm font-semibold text-white focus:border-primary focus:bg-primary/5 focus:outline-none transition-all placeholder-gray-600"
                    placeholder={field.ph}
                    value={field.val}
                    onChange={(e) => onUpdate(data.id, { [field.key]: field.key === 'thickness' ? e.target.value : parseFloat(e.target.value) })}
                  />
                </div>
              ))}
            </div>
          </div>

          {/* Row 3: Mode and Quantity */}
          <div className="grid grid-cols-2 gap-4 mb-4 items-end">
            <div>
              <label className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1 block">Mode</label>
              <div className="flex bg-zinc-900/40 p-1 rounded-lg border border-zinc-700/60 relative isolate">
                {/* Sliding background for toggle */}
                <div 
                  className={`absolute top-1 bottom-1 w-[calc(50%-4px)] bg-gradient-to-br from-primary to-secondary rounded-md transition-all duration-300 -z-10 shadow-lg ${data.mode === 'boxes' ? 'left-[calc(50%+2px)]' : 'left-1'}`} 
                />
                <button 
                  onClick={() => onUpdate(data.id, { mode: 'area' })}
                  className={`flex-1 text-xs font-bold py-2.5 text-center rounded-md transition-colors uppercase ${data.mode === 'area' ? 'text-white' : 'text-gray-400 hover:text-gray-200'}`}
                >
                  Area
                </button>
                <button 
                  onClick={() => onUpdate(data.id, { mode: 'boxes' })}
                  className={`flex-1 text-xs font-bold py-2.5 text-center rounded-md transition-colors uppercase ${data.mode === 'boxes' ? 'text-white' : 'text-gray-400 hover:text-gray-200'}`}
                >
                  Boxes
                </button>
              </div>
            </div>
            <div>
              <label className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1 block">
                {data.mode === 'area' ? 'Area (ft²)' : 'Boxes'}
              </label>
              <input
                type="number"
                className="w-full bg-zinc-900/40 border border-zinc-700/60 rounded-lg py-3 px-3 text-sm font-medium text-white focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all shadow-inner"
                placeholder="Enter..."
                value={data.quantity || ''}
                onChange={(e) => onUpdate(data.id, { quantity: parseFloat(e.target.value) })}
              />
            </div>
          </div>

          {/* Row 4: Price & GST */}
          <div className="bg-gradient-to-b from-zinc-800/30 to-zinc-900/30 border border-zinc-700/40 rounded-lg p-3 mb-4">
            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1 block">Price/sq.ft</label>
                <div className="relative group">
                  <span className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 font-bold group-focus-within:text-primary transition-colors">₹</span>
                  <input
                    type="number"
                    className="w-full bg-zinc-900/40 border border-zinc-700/60 rounded-lg py-2 pl-7 pr-3 text-sm font-medium text-white focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all"
                    placeholder="0.00"
                    value={data.price || ''}
                    onChange={(e) => onUpdate(data.id, { price: parseFloat(e.target.value) })}
                  />
                </div>
              </div>
              <div>
                <label className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1 block text-center">GST %</label>
                <div className="relative">
                  <select
                    className="w-full bg-zinc-900/40 border border-zinc-700/60 rounded-lg py-2 px-3 text-sm font-medium text-white focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all appearance-none text-center cursor-pointer"
                    value={data.gst}
                    onChange={(e) => onUpdate(data.id, { gst: parseFloat(e.target.value) })}
                  >
                    <option value={0}>None</option>
                    <option value={18}>18%</option>
                    <option value={12}>12%</option>
                    <option value={5}>5%</option>
                  </select>
                  <div className="absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500">
                    <svg width="10" height="6" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 1L5 5L9 1" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/></svg>
                  </div>
                </div>
              </div>
            </div>
          </div>

          {/* Row 5: Results Dashboard */}
          <div className="flex flex-col gap-2">
            <div className="grid grid-cols-3 gap-2">
              <div className="bg-white/5 border border-white/5 rounded-lg p-2 text-center hover:bg-white/10 transition-colors">
                <div className="text-[10px] text-gray-400 font-bold uppercase mb-0.5">Boxes</div>
                <div className="text-base font-bold text-white">{numBoxes > 0 ? fmt.format(numBoxes) : '-'}</div>
              </div>
              <div className="bg-white/5 border border-white/5 rounded-lg p-2 text-center hover:bg-white/10 transition-colors">
                <div className="text-[10px] text-gray-400 font-bold uppercase mb-0.5">Area (ft²)</div>
                <div className="text-base font-bold text-white">{totalAreaFt2 > 0 ? fmt.format(totalAreaFt2) : '-'}</div>
              </div>
              <div className="bg-white/5 border border-white/5 rounded-lg p-2 text-center hover:bg-white/10 transition-colors">
                <div className="text-[10px] text-gray-400 font-bold uppercase mb-0.5">Weight (t)</div>
                <div className="text-base font-bold text-white">{totalWeight > 0 ? fmt3.format(totalWeight) : '-'}</div>
              </div>
            </div>
            
            <div className="bg-gradient-to-r from-primary/15 to-secondary/15 border border-primary/20 rounded-lg px-4 py-3 flex justify-between items-center shadow-lg relative overflow-hidden">
               <div className="absolute inset-0 bg-gradient-to-r from-primary/5 to-transparent opacity-50"></div>
              <div className="text-xs font-bold text-primary-light uppercase tracking-wide relative z-10 text-indigo-300">Total Amount</div>
              <div className="text-xl font-extrabold text-white text-shadow-sm relative z-10">
                {totalPrice > 0 ? fmtCurr.format(totalPrice) : '-'}
              </div>
            </div>
          </div>

          {/* Meta Text */}
          <div className="text-center mt-3 text-[10px] text-gray-500 italic font-medium">
            {ft2PerBox > 0 
              ? `${data.piecesPerBox} pcs/box • ${fmt2.format(ft2PerBox)} ft²/box • ${fmt2.format(m2PerBox)} m²/box` 
              : 'Enter size & packing details to calculate'}
          </div>
        </div>
      );
    });

    // 2. Main App Component
    const App = () => {
      const [mode, setMode] = useState('basic');
      const [cards, setCards] = useState([{ ...INITIAL_CARD, id: uuidv4() }]);
      const [results, setResults] = useState({});
      const [headerVisible, setHeaderVisible] = useState(true);
      const [lastScrollY, setLastScrollY] = useState(0);
      const [copyFeedback, setCopyFeedback] = useState(false);

      // --- Scroll Header Logic ---
      useEffect(() => {
        const handleScroll = () => {
          const currentScrollY = window.scrollY;
          if (currentScrollY > lastScrollY && currentScrollY > 50) {
            setHeaderVisible(false);
          } else {
            setHeaderVisible(true);
          }
          setLastScrollY(currentScrollY);
        };

        window.addEventListener('scroll', handleScroll, { passive: true });
        return () => window.removeEventListener('scroll', handleScroll);
      }, [lastScrollY]);

      // --- Card Handlers ---
      const addCard = () => {
        setCards(prev => [...prev, { ...INITIAL_CARD, id: uuidv4() }]);
      };

      const updateCard = useCallback((id, updates) => {
        setCards(prev => prev.map(card => card.id === id ? { ...card, ...updates } : card));
      }, []);

      const deleteCard = useCallback((id) => {
        setCards(prev => prev.filter(card => card.id !== id));
        setResults(prev => {
          const newResults = { ...prev };
          delete newResults[id];
          return newResults;
        });
      }, []);

      const updateResult = useCallback((id, result) => {
        setResults(prev => {
          // Only update if changed to avoid loop
          if (JSON.stringify(prev[id]) !== JSON.stringify(result)) {
            return { ...prev, [id]: result };
          }
          return prev;
        });
      }, []);

      const refreshApp = () => {
        if(window.confirm("Reset all calculations?")) {
          setCards([{ ...INITIAL_CARD, id: uuidv4() }]);
          setResults({});
        }
      };

      const switchMode = (newMode) => {
        if (mode !== newMode) {
          setMode(newMode);
          // Reset cards on mode switch for cleaner UX
          setCards([{ ...INITIAL_CARD, id: uuidv4() }]);
          setResults({});
        }
      };

      // --- Grand Total Calculation ---
      const grandTotal = useMemo(() => {
        return Object.values(results).reduce((acc, curr) => ({
          boxes: acc.boxes + curr.numBoxes,
          area: acc.area + curr.totalAreaFt2,
          weight: acc.weight + curr.totalWeightTons,
          price: acc.price + curr.totalPrice
        }), { boxes: 0, area: 0, weight: 0, price: 0 });
      }, [results]);

      // --- Sharing Logic ---
      const getShareText = () => {
        let text = '';
        const fmt = new Intl.NumberFormat('en-IN');
        
        if (mode === 'basic') {
          const card = cards[0];
          const res = results[card.id];
          if (!res) return '';

          text = `*TILE CALCULATION*\n`;
          text += `Size: ${card.skuName || 'Custom'}\n`;
          text += `Specs: ${card.length}x${card.width}mm | ${card.piecesPerBox} pcs/box\n`;
          text += `------------------\n`;
          text += `Boxes: ${res.numBoxes}\n`;
          text += `Area: ${fmt.format(res.totalAreaFt2)} sq ft\n`;
          text += `Weight: ${res.totalWeightTons.toFixed(3)} tons\n`;
          if (res.totalPrice > 0) text += `Amount: ₹${fmt.format(Math.round(res.totalPrice))}`;
        } else {
          text = `*PROJECT ESTIMATE*\n\n`;
          cards.forEach((card, idx) => {
            const res = results[card.id];
            if (res && res.numBoxes > 0) {
              text += `#${idx + 1} ${card.skuName || 'Item'}\n`;
              text += `Boxes: ${res.numBoxes} | Area: ${fmt.format(res.totalAreaFt2)} ft²\n\n`;
            }
          });
          text += `------------------\n`;
          text += `*GRAND TOTAL*\n`;
          text += `Boxes: ${fmt.format(grandTotal.boxes)}\n`;
          text += `Area: ${fmt.format(grandTotal.area)} ft²\n`;
          text += `Weight: ${grandTotal.weight.toFixed(3)} tons\n`;
          text += `Amount: ₹${fmt.format(Math.round(grandTotal.price))}`;
        }
        return text;
      };

      const handleShare = (type) => {
        const text = getShareText();
        const encodedText = encodeURIComponent(text);

        switch (type) {
          case 'whatsapp':
            window.open(`https://wa.me/?text=${encodedText}`, '_blank');
            break;
          case 'sms':
            window.open(`sms:?body=${encodedText}`, '_self');
            break;
          case 'email':
            window.location.href = `mailto:?subject=Tile Calculation&body=${encodedText}`;
            break;
          case 'copy':
            navigator.clipboard.writeText(text).then(() => {
              setCopyFeedback(true);
              setTimeout(() => setCopyFeedback(false), 2000);
            });
            break;
        }
      };

      const ShareButtons = () => (
        <div className="flex justify-center gap-3 mt-6 pt-6 border-t border-white/10 animate-fade-in">
          <button onClick={() => handleShare('whatsapp')} className="w-10 h-10 rounded-full flex items-center justify-center bg-gradient-to-br from-[#25D366] to-[#128C7E] shadow-lg hover:scale-110 transition-transform active:scale-95">
            <MessageSquare size={18} color="white" fill="white" />
          </button>
          <button onClick={() => handleShare('sms')} className="w-10 h-10 rounded-full flex items-center justify-center bg-gradient-to-br from-cyan-400 to-cyan-600 shadow-lg hover:scale-110 transition-transform active:scale-95">
             <div className="font-bold text-white text-[10px]">SMS</div>
          </button>
          <button onClick={() => handleShare('email')} className="w-10 h-10 rounded-full flex items-center justify-center bg-gradient-to-br from-pink-400 to-pink-600 shadow-lg hover:scale-110 transition-transform active:scale-95">
            <Mail size={18} color="white" />
          </button>
          <button onClick={() => handleShare('copy')} className="w-10 h-10 rounded-full flex items-center justify-center bg-gradient-to-br from-indigo-400 to-indigo-600 shadow-lg hover:scale-110 transition-transform active:scale-95">
            <Copy size={18} color="white" />
          </button>
          <button onClick={refreshApp} className="w-10 h-10 rounded-full flex items-center justify-center bg-gradient-to-br from-orange-400 to-orange-600 shadow-lg hover:scale-110 transition-transform active:scale-95">
            <RefreshCcw size={18} color="white" />
          </button>
        </div>
      );

      return (
        <div className="min-h-screen pb-10 font-sans">
          {/* Sticky Header */}
          <header className={`fixed top-0 w-full z-40 transition-transform duration-300 ${headerVisible ? 'translate-y-0' : '-translate-y-full'}`}>
            <div className="glass border-b border-white/5 px-5 py-4 shadow-2xl">
              <div className="max-w-2xl mx-auto flex justify-between items-center">
                 <div className="flex items-center gap-2.5">
                    {/* Logo */}
                    <div className="w-8 h-8 bg-gradient-to-br from-primary to-secondary rounded-lg flex items-center justify-center font-bold text-white shadow-lg shadow-primary/20">T</div>
                    <h1 className="text-lg font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-300 tracking-tight">TilesPro</h1>
                 </div>
                 <button onClick={refreshApp} className="p-2 rounded-full hover:bg-white/10 text-gray-400 hover:text-white transition-colors">
                   <RefreshCcw size={20} />
                 </button>
              </div>
            </div>
          </header>

          <main className="pt-24 px-4 max-w-2xl mx-auto">
            {/* Mode Switcher */}
            <div className="bg-zinc-900/40 p-1 rounded-xl border border-white/10 flex mb-6 relative isolate shadow-lg">
               <div 
                  className={`absolute top-1 bottom-1 w-[calc(50%-4px)] bg-gradient-to-br from-primary to-secondary rounded-lg transition-all duration-300 -z-10 shadow-md ${mode === 'advanced' ? 'translate-x-[calc(100%+8px)]' : 'translate-x-0'}`} 
                />
              <button 
                onClick={() => switchMode('basic')}
                className={`flex-1 py-2.5 text-sm font-bold uppercase tracking-wide rounded-lg transition-colors ${mode === 'basic' ? 'text-white' : 'text-gray-400 hover:text-gray-200'}`}
              >
                Basic
              </button>
              <button 
                 onClick={() => switchMode('advanced')}
                 className={`flex-1 py-2.5 text-sm font-bold uppercase tracking-wide rounded-lg transition-colors ${mode === 'advanced' ? 'text-white' : 'text-gray-400 hover:text-gray-200'}`}
              >
                Advanced
              </button>
            </div>

            {/* Cards List */}
            <div className="space-y-4">
              {cards.map(card => (
                <CalculatorCard 
                  key={card.id} 
                  data={card} 
                  isAdvanced={mode === 'advanced'}
                  isSingle={cards.length === 1}
                  onUpdate={updateCard} 
                  onDelete={deleteCard}
                  onResultChange={updateResult}
                />
              ))}
            </div>

            {/* Add More Button (Advanced Mode) */}
            {mode === 'advanced' && (
              <button 
                onClick={addCard}
                className="w-full mt-4 py-4 border-2 border-dashed border-primary/40 rounded-xl flex items-center justify-center gap-2 text-primary-light font-bold hover:bg-primary/5 hover:border-primary transition-all active:scale-[0.98] uppercase tracking-wider text-sm animate-fade-in"
              >
                <Plus size={20} />
                Add Item
              </button>
            )}

            {/* Grand Total (Advanced Mode) */}
            {mode === 'advanced' && (
              <div className="mt-6 glass-card rounded-2xl p-5 border-t-4 border-t-secondary animate-fade-in">
                 <div className="text-center text-xs font-extrabold uppercase text-gray-500 tracking-[0.25em] mb-5">Grand Total Estimate</div>
                 <div className="grid grid-cols-2 gap-3">
                    <div className="bg-zinc-900/40 rounded-lg p-3 text-center border border-white/5">
                      <div className="text-[10px] text-gray-500 uppercase font-bold mb-1">Total Boxes</div>
                      <div className="text-lg font-bold text-white">{new Intl.NumberFormat('en-IN').format(grandTotal.boxes)}</div>
                    </div>
                    <div className="bg-zinc-900/40 rounded-lg p-3 text-center border border-white/5">
                      <div className="text-[10px] text-gray-500 uppercase font-bold mb-1">Total Area</div>
                      <div className="text-lg font-bold text-white">{new Intl.NumberFormat('en-IN').format(grandTotal.area)} <span className="text-xs text-gray-500 font-normal">ft²</span></div>
                    </div>
                    <div className="bg-zinc-900/40 rounded-lg p-3 text-center border border-white/5">
                      <div className="text-[10px] text-gray-500 uppercase font-bold mb-1">Total Weight</div>
                      <div className="text-lg font-bold text-white">{new Intl.NumberFormat('en-IN', { maximumFractionDigits: 3 }).format(grandTotal.weight)} <span className="text-xs text-gray-500 font-normal">t</span></div>
                    </div>
                    <div className="bg-zinc-900/40 rounded-lg p-3 text-center border border-white/5 relative overflow-hidden">
                       <div className="absolute inset-0 bg-primary/10"></div>
                      <div className="text-[10px] text-primary-light uppercase font-bold mb-1 relative z-10">Final Amount</div>
                      <div className="text-lg font-bold text-white relative z-10">{new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 }).format(grandTotal.price)}</div>
                    </div>
                 </div>
              </div>
            )}

            {/* Share Section (Advanced always, Basic only if calc exists) */}
            {(mode === 'advanced' || (mode === 'basic' && results[cards[0].id]?.numBoxes > 0)) && (
              <ShareButtons />
            )}

          </main>

          {/* Copy Feedback Toast */}
          <div className={`fixed top-24 left-1/2 -translate-x-1/2 bg-emerald-500 text-white px-5 py-3 rounded-full shadow-2xl font-bold text-sm transition-all duration-300 z-50 flex items-center gap-2 backdrop-blur-md bg-opacity-90 ${copyFeedback ? 'opacity-100 translate-y-0 scale-100' : 'opacity-0 -translate-y-4 scale-95 pointer-events-none'}`}>
             <Copy size={18} /> Copied to clipboard!
          </div>
        </div>
      );
    };

    // Render App
    const rootElement = document.getElementById('root');
    const root = createRoot(rootElement);
    root.render(<App />);
  </script>
</body>
</html>
