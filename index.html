<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
  <title>TilesPro Calculator</title>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <script src="../imagedata.js"></script>
  
  <style>
    :root {
      /* --- PREMIUM THEME COLORS --- */
      --primary: #6366f1; 
      --primary-light: #a855f7;
      --bg-primary: #0a0a0b;
      
      --glass-bg: rgba(30, 30, 35, 0.7);
      --glass-border: rgba(255, 255, 255, 0.08);
      --glass-highlight: rgba(255, 255, 255, 0.03);
      
      --text-primary: #ffffff;
      --text-secondary: #94a3b8;
      
      --radius-card: 16px;
      --radius-input: 10px;

      --safe-area-top: env(safe-area-inset-top);
      --safe-area-bottom: env(safe-area-inset-bottom);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg-primary);
      background-image: radial-gradient(circle at 50% 0%, rgba(99, 102, 241, 0.15) 0%, transparent 40%);
      color: var(--text-primary);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: max(15px, var(--safe-area-top)) 15px max(15px, var(--safe-area-bottom)) 15px;
    }

    /* --- HEADER (Clean & Minimal) --- */
    .app-header {
      width: 100%; max-width: 600px;
      display: flex; justify-content: space-between; align-items: center;
      padding: 10px 0 20px 0;
    }
    .logo-container { display: flex; align-items: center; gap: 12px; }
    .logo-container img { height: 32px; width: auto; object-fit: contain; }
    .header-btn { background: none; border: none; color: var(--text-secondary); padding: 8px; cursor: pointer; }

    .container { width: 100%; max-width: 600px; padding-bottom: 40px; }

    /* --- IOS STYLE SEGMENT CONTROL (Mode Switch) --- */
    .mode-switch {
      display: flex;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 4px;
      margin-bottom: 20px;
      position: relative;
    }
    .mode-switch-option {
      flex: 1; padding: 10px;
      background: none; border: none;
      color: var(--text-secondary);
      font-size: 0.85rem; font-weight: 600;
      cursor: pointer; position: relative; z-index: 2;
      transition: color 0.3s;
    }
    .mode-switch-option.active { color: white; }
    .mode-switch::after {
      content: ''; position: absolute; top: 4px; left: 4px; bottom: 4px; width: calc(50% - 4px);
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      border-radius: 10px; transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1); z-index: 1;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    }
    .mode-switch.advanced-mode::after { transform: translateX(100%); }

    /* --- PREMIUM CARD DESIGN --- */
    .calculator-card {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      border-radius: var(--radius-card);
      padding: 20px;
      margin-bottom: 16px;
      position: relative;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    .delete-card-btn {
      position: absolute; top: -10px; right: -10px;
      width: 28px; height: 28px;
      border-radius: 50%; border: none;
      background: #ef4444; color: white;
      box-shadow: 0 4px 10px rgba(239, 68, 68, 0.4);
      display: none; align-items: center; justify-content: center;
      z-index: 10; cursor: pointer;
    }
    .container.advanced-mode .delete-card-btn { display: flex; }

    /* --- INPUT STYLING (App Quality) --- */
    .form-group { margin-bottom: 12px; }
    
    .form-input, .form-select {
      width: 100%;
      padding: 12px 14px;
      background: rgba(0,0,0,0.3);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-input);
      color: white;
      font-size: 1rem; font-weight: 500;
      transition: all 0.2s;
    }
    .form-input:focus { 
      border-color: var(--primary); 
      background: rgba(99, 102, 241, 0.05);
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
    }
    .form-input::placeholder { color: rgba(255,255,255,0.2); }

    /* --- SEARCH BAR --- */
    .input-wrapper { position: relative; margin-bottom: 15px; }
    .sku-search { padding-right: 40px; font-weight: 600; letter-spacing: 0.3px; }
    .clear-sku-btn {
        position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
        background: none; border: none; color: var(--text-secondary);
        display: none; padding: 5px; cursor: pointer;
    }
    .clear-sku-btn.show { display: block; }
    
    .suggestions-list {
        position: absolute; top: 100%; left: 0; right: 0;
        background: #1e1e24; border: 1px solid var(--glass-border);
        border-radius: 0 0 12px 12px; max-height: 220px; overflow-y: auto;
        z-index: 100; display: none; margin-top: 4px; box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    }
    .suggestion-item { padding: 12px 16px; font-size: 0.9rem; border-bottom: 1px solid rgba(255,255,255,0.05); color: #e2e8f0; }
    .suggestion-item:active { background: var(--primary); color: white; }

    /* --- SMART 5-BOX GRID (Professional Data Look) --- */
    .specs-container {
        background: rgba(255,255,255,0.02);
        border: 1px solid var(--glass-border);
        border-radius: var(--radius-input);
        padding: 10px;
        margin-bottom: 15px;
    }
    .specs-grid-5 {
        display: grid;
        /* Custom Proportions: L & W (Wide), mm & Pcs (Narrow), Kg (Medium) */
        grid-template-columns: 1.4fr 1.4fr 0.9fr 0.9fr 1.1fr; 
        gap: 8px;
    }
    .spec-box { display: flex; flex-direction: column; align-items: center; }
    .spec-box label { 
        font-size: 0.65rem; color: var(--primary-light); margin-bottom: 4px; 
        text-transform: uppercase; font-weight: 700; letter-spacing: 0.5px;
    }
    .spec-input {
        width: 100%; padding: 8px 4px;
        text-align: center;
        background: rgba(0,0,0,0.4);
        border: 1px solid rgba(255,255,255,0.1);
        border-radius: 6px;
        color: white;
        font-size: 0.9rem; font-weight: 600;
    }
    .spec-input:focus { border-color: var(--primary); background: rgba(99,102,241,0.15); }

    /* --- HYBRID ROW: TOGGLE & INPUT --- */
    .smart-row { display: grid; grid-template-columns: 1.2fr 1fr; gap: 12px; margin-bottom: 12px; align-items: center; }
    
    /* The Colored Toggle Button */
    .mode-toggle {
      display: flex;
      background: rgba(0,0,0,0.4);
      border-radius: 8px;
      padding: 3px;
      height: 48px; /* Touch friendly height */
    }
    .mode-option {
      flex: 1; background: none; border: none;
      color: var(--text-secondary); font-size: 0.75rem; font-weight: 600;
      border-radius: 6px; cursor: pointer; transition: all 0.2s;
    }
    
    /* ACTIVE STATE WITH COLOR */
    .mode-option.active { 
      background: linear-gradient(135deg, var(--primary), var(--primary-light)); 
      color: white; 
      box-shadow: 0 2px 8px rgba(99, 102, 241, 0.4);
    }

    /* --- PRICE ROW --- */
    .price-container { position: relative; }
    .price-container::before {
      content: '₹'; position: absolute; left: 14px; top: 50%; transform: translateY(-50%);
      color: var(--text-secondary); font-size: 1rem;
    }
    .price-input { padding-left: 28px; }

    /* --- RESULTS GRID (Dashboard Style) --- */
    .results-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px dashed var(--glass-border);
    }
    .result-item {
      text-align: center;
    }
    .result-label { font-size: 0.6rem; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 4px; letter-spacing: 0.5px; }
    .result-value { 
      font-size: 1rem; color: white; font-weight: 700; 
      background: rgba(255,255,255,0.03); padding: 6px 2px; border-radius: 6px;
    }
    /* Highlight Total Amount */
    .result-item:last-child .result-value { color: #4ade80; background: rgba(74, 222, 128, 0.1); }

    .results-meta {
        font-size: 0.75rem; color: var(--text-secondary); text-align: center;
        margin-top: 12px; font-style: italic;
    }

    /* --- BUTTONS --- */
    .add-more-btn {
      width: 100%; padding: 14px;
      background: rgba(99, 102, 241, 0.15);
      border: 1px dashed var(--primary);
      border-radius: 12px;
      color: var(--primary-light);
      font-size: 0.9rem; font-weight: 600; letter-spacing: 0.5px;
      cursor: pointer; margin-bottom: 20px;
      display: none; align-items: center; justify-content: center; gap: 8px;
      transition: all 0.2s;
    }
    .add-more-btn:active { background: rgba(99, 102, 241, 0.25); transform: scale(0.98); }
    .container.advanced-mode .add-more-btn { display: flex; }

    /* --- GRAND TOTAL CARD --- */
    .grand-total {
        background: linear-gradient(145deg, rgba(30, 30, 35, 0.9), rgba(20, 20, 25, 0.95));
        border: 1px solid var(--primary);
        border-radius: var(--radius-card); padding: 20px; margin-bottom: 20px;
        display: none; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    .container.advanced-mode .grand-total { display: block; }
    .grand-total-header { text-align: center; font-size: 0.9rem; font-weight: 700; margin-bottom: 15px; color: var(--primary-light); text-transform: uppercase; letter-spacing: 2px; }

    /* --- SHARE BUTTONS --- */
    .share-row { display: flex; justify-content: center; gap: 15px; margin-top: 15px; }
    .container.advanced-mode .basic-share-section { display: none; }
    
    .share-btn {
      width: 44px; height: 44px; border-radius: 12px; border: none; cursor: pointer;
      display: flex; align-items: center; justify-content: center; transition: transform 0.2s;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .share-btn:active { transform: scale(0.9); }
    .share-whatsapp { background: linear-gradient(135deg, #25D366, #128C7E); }
    .share-sms { background: linear-gradient(135deg, #06b6d4, #0891b2); }
    .share-email { background: linear-gradient(135deg, #ec4899, #db2777); }
    .share-copy { background: linear-gradient(135deg, var(--primary), var(--primary-light)); }
    .share-clear { background: linear-gradient(135deg, var(--text-secondary), #64748b); }
    .share-icon { width: 20px; height: 20px; fill: white; }

    .copy-message {
      position: fixed; top: 80px; left: 50%; transform: translateX(-50%) translateY(-20px);
      background: #10b981; color: white; padding: 10px 20px; border-radius: 30px;
      font-size: 0.9rem; font-weight: 600; opacity: 0; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      z-index: 1000; box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4); pointer-events: none;
    }
    .copy-message.show { transform: translateX(-50%) translateY(0); opacity: 1; }

  </style>
</head>
<body>

  <header class="app-header">
    <div class="logo-container">
        <img id="logoA" alt="Logo">
        <img id="logoGranicer2" alt="Logo2"> 
    </div>
    <button id="refresh-btn" class="header-btn">
        <i class="fas fa-sync-alt"></i>
    </button>
  </header>
  
  <div class="container">
    <div class="mode-switch" id="modeSwitch">
      <button class="mode-switch-option active" data-mode="basic">Basic Calculator</button>
      <button class="mode-switch-option" data-mode="advanced">Multi-List</button>
    </div>

    <div id="calculatorCards"></div>

    <button class="add-more-btn" id="addMoreBtn">
      <i class="fas fa-plus"></i> Add Another Size
    </button>

    <div class="grand-total">
      <div class="grand-total-header">Final Summary</div>
      <div class="results-grid" style="border:none; margin:0; padding:0;">
        <div class="result-item"><div class="result-label">Total Box</div><div class="result-value" id="grandTotalBoxes">-</div></div>
        <div class="result-item"><div class="result-label">Total Area</div><div class="result-value" id="grandTotalArea">-</div></div>
        <div class="result-item"><div class="result-label">Total Wt</div><div class="result-value" id="grandTotalWeight">-</div></div>
        <div class="result-item"><div class="result-label">Amount</div><div class="result-value" id="grandFinalAmount">-</div></div>
      </div>
    </div>

    <div class="share-row share-section" style="display:none;">
      <button class="share-btn share-whatsapp" id="shareWhatsapp"><svg class="share-icon" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.891 3.486"/></svg></button>
      <button class="share-btn share-sms" id="shareSMS"><svg class="share-icon" viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0 -1.1-.9-2-2-2zM9 11H7V9h2v2zm4 0h-2V9h2v2zm4 0h-2V9h2v2z"/></svg></button>
      <button class="share-btn share-email" id="shareEmail"><svg class="share-icon" viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg></button>
      <button class="share-btn share-copy" id="copyBtn"><svg class="share-icon" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg></button>
      <button class="share-btn share-clear" id="clearBtn"><svg class="share-icon" viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg></button>
    </div>
  </div>

  <div class="copy-message" id="copyMessage">✓ Details Copied!</div>

  <script>
    const SKU_MASTER = [
        { name: "300x600 mm (12x24) Wall", l: 300, w: 600, mm: "8.5", pcs: 5, kg: 13.5 },
        { name: "300x450 mm (12x18) Wall", l: 300, w: 450, mm: "7.5", pcs: 6, kg: 10.5 },
        { name: "250x375 mm (10x15) Wall", l: 250, w: 375, mm: "7", pcs: 8, kg: 10 },
        { name: "600x600 mm (2x2) GVT", l: 600, w: 600, mm: "8.5", pcs: 4, kg: 27 },
        { name: "600x1200 mm (2x4) GVT", l: 600, w: 1200, mm: "9", pcs: 2, kg: 28 },
        { name: "800x800 mm (32x32) GVT", l: 800, w: 800, mm: "9", pcs: 3, kg: 38 },
        { name: "800x1600 mm (32x64) GVT", l: 800, w: 1600, mm: "9", pcs: 2, kg: 50 },
        { name: "1000x1000 mm GVT", l: 1000, w: 1000, mm: "9", pcs: 2, kg: 40 },
        { name: "1200x1200 mm (4x4)", l: 1200, w: 1200, mm: "9", pcs: 2, kg: 58 },
        { name: "1200x1800 mm (4x6)", l: 1200, w: 1800, mm: "9", pcs: 2, kg: 88 },
        { name: "1200x2400 mm (4x8) 9mm", l: 1200, w: 2400, mm: "9", pcs: 1, kg: 60 },
        { name: "1200x2400 mm (4x8) 15mm", l: 1200, w: 2400, mm: "15", pcs: 1, kg: 92 },
        { name: "300x300 mm (12x12) Heavy", l: 300, w: 300, mm: "8", pcs: 10, kg: 16 },
        { name: "400x400 mm (16x16) Parking", l: 400, w: 400, mm: "9", pcs: 5, kg: 15 },
        { name: "600x600 mm Full Body (16mm)", l: 600, w: 600, mm: "16", pcs: 2, kg: 25 },
        { name: "200x1000 mm Wood Plank", l: 200, w: 1000, mm: "9", pcs: 5, kg: 20 },
        { name: "200x1200 mm Wood Plank", l: 200, w: 1200, mm: "9", pcs: 5, kg: 23 }
    ];

    window.addEventListener('DOMContentLoaded', () => {
        try {
            if (typeof logoA_base64 !== 'undefined') document.getElementById('logoA').src = logoA_base64;
            if (typeof logoGranicer2_base64 !== 'undefined') document.getElementById('logoGranicer2').src = logoGranicer2_base64;
        } catch (e) {}
        document.getElementById('refresh-btn').addEventListener('click', () => location.reload());
        addMoreCard();
    });

    let currentAppMode = 'basic';
    let cardCounter = 0;
    let cardModes = {};
    const fmt = new Intl.NumberFormat('en-IN', { maximumFractionDigits: 2 });
    const fmt3 = new Intl.NumberFormat('en-IN', { maximumFractionDigits: 3 });

    function addMoreCard() {
        const cardId = cardCounter++;
        const cardsContainer = document.getElementById('calculatorCards');
        const isFirstCard = cardsContainer.children.length === 0;
        const newCard = document.createElement('div');
        newCard.className = 'calculator-card';
        newCard.dataset.cardId = cardId;

        newCard.innerHTML = `
            <button class="delete-card-btn" onclick="deleteCard(${cardId})"><i class="fas fa-times"></i></button>

            <div class="input-wrapper">
                <input type="text" class="form-input sku-search" data-card="${cardId}" placeholder="Search Size (e.g. 600x1200)" autocomplete="off">
                <button class="clear-sku-btn" data-card="${cardId}" onclick="clearSkuSearch(${cardId})"><i class="fas fa-times"></i></button>
                <div class="suggestions-list" id="suggestions-${cardId}"></div>
            </div>
            
            <div class="specs-container">
                <div class="specs-grid-5">
                    <div class="spec-box"><label>L(mm)</label><input type="number" class="spec-input spec-l" data-card="${cardId}" placeholder="0"></div>
                    <div class="spec-box"><label>W(mm)</label><input type="number" class="spec-input spec-w" data-card="${cardId}" placeholder="0"></div>
                    <div class="spec-box"><label>Thk</label><input type="text" class="spec-input spec-mm" data-card="${cardId}" placeholder="-"></div>
                    <div class="spec-box"><label>Pcs</label><input type="number" class="spec-input spec-pcs" data-card="${cardId}" placeholder="0"></div>
                    <div class="spec-box"><label>Kg</label><input type="number" class="spec-input spec-kg" data-card="${cardId}" placeholder="0"></div>
                </div>
            </div>

            <div class="smart-row">
                <div class="mode-toggle" data-card="${cardId}">
                    <button class="mode-option active" data-mode="area">Area</button>
                    <button class="mode-option" data-mode="boxes">Box</button>
                </div>
                <input type="number" class="form-input quantity" data-card="${cardId}" placeholder="Enter Area..." min="0" step="0.01">
            </div>

            <div class="smart-row">
                <div class="price-container">
                    <input type="number" class="form-input price-input price" data-card="${cardId}" placeholder="Price/ft²" min="0" step="0.01">
                </div>
                <select class="form-select gst" data-card="${cardId}">
                    <option value="0">No GST</option>
                    <option value="18" selected>18%</option>
                    <option value="12">12%</option>
                    <option value="5">5%</option>
                </select>
            </div>

            <div class="results-grid">
                <div class="result-item"><div class="result-label">Boxes</div><div class="result-value boxes-result">-</div></div>
                <div class="result-item"><div class="result-label">Area (ft²)</div><div class="result-value area-ft2-result">-</div></div>
                <div class="result-item"><div class="result-label">Weight (t)</div><div class="result-value weight-result">-</div></div>
                <div class="result-item"><div class="result-label">Total</div><div class="result-value total-price-result">-</div></div>
            </div>
            <div class="results-meta"></div>

            ${isFirstCard ? `
            <div class="share-row basic-share-section">
                <button class="share-btn share-whatsapp" onclick="shareWhatsApp()"><svg class="share-icon" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.891 3.486"/></svg></button>
                <button class="share-btn share-sms" onclick="shareSMS()"><svg class="share-icon" viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0 -1.1-.9-2-2-2zM9 11H7V9h2v2zm4 0h-2V9h2v2zm4 0h-2V9h2v2z"/></svg></button>
                <button class="share-btn share-email" onclick="shareEmail()"><svg class="share-icon" viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg></button>
                <button class="share-btn share-copy" onclick="copyToClipboard()"><svg class="share-icon" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg></button>
                <button class="share-btn share-clear" onclick="clearAll()"><svg class="share-icon" viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg></button>
            </div>` : ''}
        `;
        cardsContainer.appendChild(newCard);
        cardModes[cardId] = 'area';
        setupCardEventListeners(cardId);
    }

    function setupCardEventListeners(cardId) {
        const card = document.querySelector(`[data-card-id="${cardId}"]`);
        if (!card) return;
        card.querySelector('.sku-search').addEventListener('input', (e) => handleSkuSearch(e, cardId));
        const clearBtn = card.querySelector('.clear-sku-btn');
        if (clearBtn) clearBtn.addEventListener('click', () => clearSkuSearch(cardId));
        card.querySelectorAll('.spec-input').forEach(input => input.addEventListener('input', () => calculateCard(cardId)));
        card.querySelector('.quantity').addEventListener('input', () => calculateCard(cardId));
        card.querySelector('.price').addEventListener('input', () => calculateCard(cardId));
        card.querySelector('.gst').addEventListener('change', () => calculateCard(cardId));
        card.querySelector('.mode-toggle').addEventListener('click', (e) => {
            const option = e.target.closest('.mode-option');
            if (option) setCardMode(cardId, option.dataset.mode);
        });
    }

    function handleSkuSearch(event, cardId) {
        const query = event.target.value.toLowerCase();
        const suggestionsList = document.getElementById(`suggestions-${cardId}`);
        const clearBtn = document.querySelector(`[data-card="${cardId}"].clear-sku-btn`);
        if (query.length > 0) clearBtn.classList.add('show');
        else {
            clearBtn.classList.remove('show');
            suggestionsList.style.display = 'none'; return;
        }
        const matches = SKU_MASTER.filter(item => item.name.toLowerCase().includes(query));
        suggestionsList.innerHTML = '';
        if (matches.length > 0) {
            matches.forEach(sku => {
                const div = document.createElement('div');
                div.className = 'suggestion-item';
                div.textContent = sku.name;
                div.onclick = () => selectSku(cardId, sku);
                suggestionsList.appendChild(div);
            });
            suggestionsList.style.display = 'block';
        } else suggestionsList.style.display = 'none';
    }

    function selectSku(cardId, sku) {
        const card = document.querySelector(`[data-card-id="${cardId}"]`);
        card.querySelector('.sku-search').value = sku.name;
        card.querySelector('.spec-l').value = sku.l;
        card.querySelector('.spec-w').value = sku.w;
        card.querySelector('.spec-mm').value = sku.mm;
        card.querySelector('.spec-pcs').value = sku.pcs;
        card.querySelector('.spec-kg').value = sku.kg;
        document.getElementById(`suggestions-${cardId}`).style.display = 'none';
        calculateCard(cardId);
    }

    function clearSkuSearch(cardId) {
        const card = document.querySelector(`[data-card-id="${cardId}"]`);
        card.querySelector('.sku-search').value = '';
        card.querySelector('.clear-sku-btn').classList.remove('show');
        card.querySelectorAll('.spec-input').forEach(i => i.value = '');
        calculateCard(cardId);
    }

    function calculateCard(cardId) {
        const card = document.querySelector(`[data-card-id="${cardId}"]`);
        if (!card) return;
        const L = parseFloat(card.querySelector('.spec-l').value) || 0;
        const W = parseFloat(card.querySelector('.spec-w').value) || 0;
        const PCS = parseFloat(card.querySelector('.spec-pcs').value) || 0;
        const KG = parseFloat(card.querySelector('.spec-kg').value) || 0;
        const quantity = parseFloat(card.querySelector('.quantity').value || 0);
        const pricePerFt2 = parseFloat(card.querySelector('.price').value || 0);
        const gstRate = parseFloat(card.querySelector('.gst').value || 0);

        let ft2PerBox = 0;
        if (L > 0 && W > 0 && PCS > 0) ft2PerBox = ((L * W * PCS) / 1000000) * 10.7639;

        let numBoxes = 0, areaFt2 = 0, weight = 0, totalPrice = 0;
        const mode = cardModes[cardId] || 'area';

        if (quantity > 0 && ft2PerBox > 0) {
            if (mode === 'area') numBoxes = Math.ceil(quantity / ft2PerBox);
            else numBoxes = Math.ceil(quantity);
            areaFt2 = numBoxes * ft2PerBox;
            weight = (numBoxes * KG) / 1000;
            if (pricePerFt2 > 0) totalPrice = (areaFt2 * pricePerFt2) * (1 + gstRate / 100);
        }

        card.querySelector('.boxes-result').textContent = numBoxes ? fmt.format(numBoxes) : '-';
        card.querySelector('.area-ft2-result').textContent = areaFt2 ? fmt.format(areaFt2) : '-';
        card.querySelector('.weight-result').textContent = weight ? fmt3.format(weight) : '-';
        card.querySelector('.total-price-result').textContent = totalPrice > 0 ? '₹' + Math.round(totalPrice).toLocaleString('en-IN') : '-';
        
        const metaText = ft2PerBox > 0 ? `${PCS}pcs | ${ft2PerBox.toFixed(2)} ft²/box` : 'Enter details above';
        card.querySelector('.results-meta').textContent = metaText;

        if (currentAppMode === 'advanced') updateGrandTotal();
    }

    function setCardMode(cardId, mode) {
        cardModes[cardId] = mode;
        const card = document.querySelector(`[data-card-id="${cardId}"]`);
        const modeToggle = card.querySelector('.mode-toggle');
        const quantityInput = card.querySelector('.quantity');
        
        modeToggle.classList.toggle('boxes-mode', mode === 'boxes');
        modeToggle.querySelectorAll('.mode-option').forEach(opt => opt.classList.toggle('active', opt.dataset.mode === mode));
        quantityInput.placeholder = mode === 'area' ? 'Enter Area (ft²)' : 'Enter Boxes';
        calculateCard(cardId);
    }

    function updateGrandTotal() {
        const cards = document.querySelectorAll('.calculator-card');
        let totalBoxes = 0, totalArea = 0, totalWeight = 0, totalFinalAmount = 0;
        cards.forEach(card => {
            totalBoxes += parseFloat(card.querySelector('.boxes-result').textContent.replace(/[^0-9.-]+/g,"") || 0);
            totalArea += parseFloat(card.querySelector('.area-ft2-result').textContent.replace(/[^0-9.-]+/g,"") || 0);
            totalWeight += parseFloat(card.querySelector('.weight-result').textContent.replace(/[^0-9.-]+/g,"") || 0);
            totalFinalAmount += parseFloat(card.querySelector('.total-price-result').textContent.replace(/[^0-9.-]+/g,"") || 0);
        });
        document.getElementById('grandTotalBoxes').textContent = totalBoxes > 0 ? fmt.format(totalBoxes) : '-';
        document.getElementById('grandTotalArea').textContent = totalArea > 0 ? fmt.format(totalArea) + ' ft²' : '-';
        document.getElementById('grandTotalWeight').textContent = totalWeight > 0 ? fmt3.format(totalWeight) + ' t' : '-';
        document.getElementById('grandFinalAmount').textContent = totalFinalAmount > 0 ? '₹' + Math.round(totalFinalAmount).toLocaleString('en-IN') : '-';
    }

    function switchMode(mode) {
        currentAppMode = mode;
        const container = document.querySelector('.container');
        const modeSwitch = document.getElementById('modeSwitch');
        
        document.getElementById('calculatorCards').innerHTML = '';
        cardCounter = 0; cardModes = {}; addMoreCard();

        if (mode === 'advanced') {
            container.classList.add('advanced-mode');
            modeSwitch.classList.add('advanced-mode');
            document.querySelector('.share-section').style.display = 'flex';
        } else {
            container.classList.remove('advanced-mode');
            modeSwitch.classList.remove('advanced-mode');
            document.querySelector('.share-section').style.display = 'none';
        }
        modeSwitch.querySelectorAll('.mode-switch-option').forEach(opt => opt.classList.toggle('active', opt.dataset.mode === mode));
    }

    function deleteCard(cardId) {
        const card = document.querySelector(`[data-card-id="${cardId}"]`);
        if (card) { 
            card.style.opacity = '0'; card.style.transform = 'scale(0.9)';
            setTimeout(() => { card.remove(); delete cardModes[cardId]; updateGrandTotal(); }, 300);
        }
    }

    function getShareText() {
        const cards = document.querySelectorAll('.calculator-card');
        let text = '';
        if (currentAppMode === 'basic') {
            const card = cards[0];
            const skuName = card.querySelector('.sku-search').value || 'Custom';
            text = `*TILE ESTIMATE*\nSize: ${skuName}\nBoxes: ${card.querySelector('.boxes-result').textContent}\nArea: ${card.querySelector('.area-ft2-result').textContent} ft²\nTotal: ${card.querySelector('.total-price-result').textContent}`;
        } else {
            text = '*TILE ESTIMATE*\n\n';
            cards.forEach((card, i) => {
                const b = card.querySelector('.boxes-result').textContent;
                if(b!=='-') text += `#${i+1} ${card.querySelector('.sku-search').value || 'Item'}: ${b} Bx | ${card.querySelector('.area-ft2-result').textContent} ft²\n`;
            });
            text += `\n*GRAND TOTAL: ${document.getElementById('grandFinalAmount').textContent}*`;
        }
        return text;
    }
    
    function shareWhatsApp() { window.open(`https://wa.me/?text=${encodeURIComponent(getShareText())}`, '_blank'); }
    function shareSMS() { window.open(`sms:?body=${encodeURIComponent(getShareText())}`, '_self'); }
    function shareEmail() { window.location.href = `mailto:?subject=Estimate&body=${encodeURIComponent(getShareText())}`; }
    function copyToClipboard() {
        navigator.clipboard.writeText(getShareText()).then(() => {
            const msg = document.getElementById('copyMessage');
            msg.classList.add('show'); setTimeout(() => msg.classList.remove('show'), 2000);
        });
    }
    function clearAll() {
        document.querySelectorAll('.calculator-card').forEach(card => {
            card.querySelectorAll('input').forEach(i => i.value = '');
            calculateCard(card.dataset.cardId);
        });
    }

    document.getElementById('modeSwitch').addEventListener('click', (e) => {
        const opt = e.target.closest('.mode-switch-option');
        if (opt) switchMode(opt.dataset.mode);
    });
    document.getElementById('addMoreBtn').addEventListener('click', addMoreCard);
    document.getElementById('shareWhatsapp').addEventListener('click', shareWhatsApp);
    document.getElementById('shareSMS').addEventListener('click', shareSMS);
    document.getElementById('shareEmail').addEventListener('click', shareEmail);
    document.getElementById('copyBtn').addEventListener('click', copyToClipboard);
    document.getElementById('clearBtn').addEventListener('click', clearAll);
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.input-wrapper')) document.querySelectorAll('.suggestions-list').forEach(l => l.style.display='none');
    });

  </script>
</body>
</html>
