<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  
  <!-- PWA Meta Tags -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="theme-color" content="#0a0a0b" />
  
  <!-- PWA Icon -->
  <link rel="apple-touch-icon" sizes="180x180" href="image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtb...

  <title>TilesPro Calculator</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* Your CSS here as given earlier, with overflow visible setting */
    /* Ensure the relevant containers have overflow visible */

    :root {
      /* as before */
    }
    body, html {
      /* as before */
    }
    .calculator-card {
      overflow: visible !important;
      /* other styles */
    }
    .container {
      overflow: visible !important;
      /* other styles */
    }
    .form-select {
      position: relative !important;
      z-index: 9999 !important;
    }
    .form-select::-ms-expand {
      position: relative;
      z-index: 10000;
    }
    /* similar styles as before for rest */
  </style>
</head>
<body>
  <div class="orb"></div>
  <div class="orb"></div>

  <div class="container">
    <div class="calculator-card">
      <div class="form-section">
        <div class="form-row">
          <div class="form-group full-width">
            <label class="form-label">Tile Size & Thickness</label>
            <select id="sizeThickness" class="form-select"></select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group full-width">
            <label class="form-label">Calculation Mode</label>
            <div class="mode-toggle" id="modeToggle">
              <button class="mode-option active" data-mode="area">Area (ft²)</button>
              <button class="mode-option" data-mode="pieces">Pieces</button>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group full-width">
            <label id="inputLabel" class="form-label">Area (ft²)</label>
            <input id="quantity" class="form-input" type="number" placeholder="Enter value..." min="0" step="0.01" inputmode="decimal" />
          </div>
        </div>
      </div>

      <div class="actions">
        <button id="copyBtn" class="btn btn-primary">Copy Details</button>
        <button id="clearBtn" class="btn btn-secondary">Clear</button>
      </div>

      <div class="results-grid">
        <div class="result-item">
          <div class="result-label">Pieces</div>
          <div id="piecesResult" class="result-value">-</div>
        </div>
        <div class="result-item">
          <div class="result-label">Area (ft²)</div>
          <div id="areaFt2" class="result-value">-</div>
        </div>
        <div class="result-item">
          <div class="result-label">Area (m²)</div>
          <div id="areaM2" class="result-value">-</div>
        </div>
        <div class="result-item">
          <div class="result-label">Weight (tons)</div>
          <div id="weight" class="result-value">-</div>
        </div>
      </div>

      <div id="meta" class="results-meta">Select tile specifications to see calculations</div>

      <div class="share-section">
        <button id="shareWhatsapp" class="share-btn share-whatsapp" title="Share on WhatsApp">
          <!-- SVG icon as before -->
        </button>
        <button id="shareSMS" class="share-btn share-sms" title="Share via SMS">
          <!-- SVG icon as before -->
        </button>
        <button id="shareEmail" class="share-btn share-email" title="Share via Email">
          <!-- SVG icon as before -->
        </button>
      </div>
    </div>
  </div>

  <div id="copyMsg" class="copy-message">✓ Details copied to clipboard!</div>

  <script>
    const SKU_MASTER = [
      {size:"800x2400",thk:"15MM",pcs:1,kg:"67.5",ft2:20.67,m2:1.9},
      {size:"790x2980",thk:"15MM",pcs:1,kg:"87",ft2:25.338,m2:2.354},
      {size:"800x3200",thk:"15MM",pcs:1,kg:"74",ft2:27.56,m2:2.6},
      {size:"1600x1600",thk:"9MM",pcs:1,kg:"55",ft2:27.556,m2:2.56},
      {size:"800x3000",thk:"15MM",pcs:1,kg:"84.5",ft2:25.834,m2:2.4},
      {size:"1620x3240",thk:"12MM",pcs:1,kg:"150",ft2:56.5,m2:5.249},
      {size:"1200x2400",thk:"9MM",pcs:1,kg:"62",ft2:31.0,m2:2.88},
      {size:"1000x3000",thk:"5MM",pcs:1,kg:"35.5",ft2:32.29,m2:3.0},
      {size:"1200x2600",thk:"6MM",pcs:1,kg:"42.5",ft2:33.58,m2:3.1},
      {size:"1200x2800",thk:"6MM",pcs:1,kg:"50.5",ft2:36.167,m2:3.36},
      {size:"1200x3180",thk:"15MM",pcs:1,kg:"136",ft2:41.075,m2:3.816},
      {size:"1200x3200",thk:"15MM",pcs:1,kg:"136",ft2:41.337,m2:3.84},
      {size:"1200x3200",thk:"15MM",pcs:1,kg:"136",ft2:41.33,m2:3.8},
      {size:"1200x1800",thk:"9MM",pcs:2,kg:"91 TO 96.5",ft2:46.5,m2:4.32},
      {size:"1200x1790",thk:"9MM",pcs:2,kg:"91",ft2:46.242,m2:4.296},
      {size:"1620x3240",thk:"12MM",pcs:1,kg:"150",ft2:56.5,m2:5.249},
      {size:"1600x3200",thk:"6MM",pcs:1,kg:"74",ft2:55.116,m2:5.12},
      {size:"1600x3200",thk:"12MM",pcs:1,kg:"148",ft2:55.116,m2:5.12},
      {size:"1200x3000",thk:"9MM",pcs:1,kg:"77.5",ft2:38.75,m2:3.6},
    ];

    // Sort SKU_MASTER by ft2 ascending
    SKU_MASTER.sort((a, b) => a.ft2 - b.ft2);

    const FT2_PER_M2 = 10.7639;
    const fmt = new Intl.NumberFormat('en-US', { maximumFractionDigits: 2 });
    const fmt3 = new Intl.NumberFormat('en-US', { maximumFractionDigits: 3 });

    let currentMode = 'area';

    const elements = {
      sizeThickness: document.getElementById('sizeThickness'),
      quantity: document.getElementById('quantity'),
      modeToggle: document.getElementById('modeToggle'),
      inputLabel: document.getElementById('inputLabel'),
      copyBtn: document.getElementById('copyBtn'),
      clearBtn: document.getElementById('clearBtn'),
      copyMsg: document.getElementById('copyMsg'),
      piecesResult: document.getElementById('piecesResult'),
      areaFt2: document.getElementById('areaFt2'),
      areaM2: document.getElementById('areaM2'),
      weight: document.getElementById('weight'),
      meta: document.getElementById('meta')
    };

    function parseKgMin(value) {
      const nums = String(value).match(/[\d.]+/g);
      return nums && nums.length ? parseFloat(nums[0]) : NaN;
    }

    function initialize() {
      elements.sizeThickness.innerHTML = SKU_MASTER.map((sku, idx) =>
        `<option value="${idx}">${sku.size} (${sku.thk})</option>`
      ).join('');
      // Default select first item:
      elements.sizeThickness.selectedIndex = 0;
      elements.quantity.value = '';
      elements.copyMsg.style.opacity = "0";
      calculate();
    }

    function getSelectedSKU() {
      return SKU_MASTER[elements.sizeThickness.value];
    }

    function calculate() {
      const sku = getSelectedSKU();
      const val = parseFloat(elements.quantity.value);
      if (!sku || isNaN(val)) {
        clearResults();
        return;
      }
      const pcsPerBox = sku.pcs;
      const ftPerComp = sku.ft2 / pcsPerBox;
      const m2PerComp = sku.m2 / pcsPerBox;
      const kgPerComp = parseKgMin(sku.kg) / pcsPerBox;

      let pieces = 0, ft2 = 0, m2 = 0, tons = 0;
      if (val > 0) {
        if (currentMode === 'area') {
          ft2 = val;
          pieces = Math.ceil(ft2 / ftPerComp);
          m2 = ft2 / FT2_PER_M2;
        } else {
          pieces = Math.ceil(val);
          ft2 = pieces * ftPerComp;
          m2 = pieces * m2PerComp;
        }
        tons = pieces * kgPerComp / 1000;
      }
      elements.piecesResult.textContent = pieces ? fmt.format(pieces) : '-';
      elements.areaFt2.textContent = ft2 ? fmt.format(ft2) : '-';
      elements.areaM2.textContent = m2 ? fmt3.format(m2) : '-';
      elements.weight.textContent = tons ? fmt3.format(tons) : '-';
      elements.meta.textContent = `${pcsPerBox} pcs/box • ${sku.ft2} ft²/box • ${sku.m2} m² • ~${parseKgMin(sku.kg)} kg`;
    }

    function clearResults() {
      elements.piecesResult.textContent = '-';
      elements.areaFt2.textContent = '-';
      elements.areaM2.textContent = '-';
      elements.weight.textContent = '-';
      elements.meta.textContent = 'Select tile specifications to see calculations';
    }

    function setMode(mode) {
      currentMode = mode;
      const btns = elements.modeToggle.querySelectorAll('button');
      btns.forEach(b => b.classList.toggle('active', b.dataset.mode === mode));
      elements.inputLabel.textContent = (mode === 'area') ? 'Area (ft²)' : 'Pieces';
      elements.quantity.placeholder = (mode === 'area') ? 'Enter area in ft²' : 'Enter pieces';
      calculate();
    }

    function getShareText() {
      const sku = getSelectedSKU();
      if (!sku) return '';
      return `Size: ${sku.size} (${sku.thk})
Pieces: ${elements.piecesResult.textContent}
Area (ft²): ${elements.areaFt2.textContent}
Area (m²): ${elements.areaM2.textContent}
Weight (tons): ${elements.weight.textContent}`;
    }

    function copyToClipboard() {
      const text = getShareText();
      if (!text) return;
      navigator.clipboard.writeText(text).then(() => {
        elements.copyMsg.classList.add('show');
        setTimeout(() => elements.copyMsg.classList.remove('show'), 2000);
      }).catch(console.error);
    }

    // Share functions for Whatsapp, SMS, Email
    function shareWhatsapp() {
      const text = getShareText();
      if (!text) return;
      const url = 'https://wa.me/?text=' + encodeURIComponent(text);
      window.open(url, '_blank');
    }
    function shareSms() {
      const text = getShareText();
      if (!text) return;
      const url = navigator.userAgent.match(/iPhone|iPad/) ? 'sms:&body=' + encodeURIComponent(text) : 'sms:?body=' + encodeURIComponent(text);
      window.location.href = url;
    }
    function shareEmail() {
      const text = getShareText();
      if (!text) return;
      const subject = encodeURIComponent('TilesPro Calculator Results');
      const body = encodeURIComponent(text);
      window.location.href = `mailto:?subject=${subject}&body=${body}`;
    }

    elements.sizeThickness.addEventListener('change', calculate);
    elements.quantity.addEventListener('input', calculate);
    elements.modeToggle.addEventListener('click', e => {
      const btn = e.target.closest('button');
      if (btn) setMode(btn.dataset.mode);
    });
    elements.copyBtn.addEventListener('click', copyToClipboard);
    elements.clearBtn.addEventListener('click', () => {
      elements.quantity.value = '';
      calculate();
    });

    document.getElementById('shareWhatsapp').addEventListener('click', shareWhatsapp);
    document.getElementById('shareSMS').addEventListener('click', shareSms);
    document.getElementById('shareEmail').addEventListener('click', shareEmail);

    // Initialize
    initialize();
  </script>
</body>
</html>
